{
  "$schema": "https://shoehorn.dev/schemas/workflow-v2.json",
  "version": "1.0.3",
  "metadata": {
    "name": "test-requires-approval",
    "displayName": "Production Deployment (Approval Required)",
    "description": "Deploy to production - requires approval from platform leads. Uses real deployment.service.production action to test approval workflow.",
    "author": "platform-team",
    "icon": "üîê",
    "category": "deployment",
    "tags": ["test", "approval", "production", "deployment"],
    "requiresApproval": true,
    "approvalMetadata": {
      "reason": "Production deployments require platform team approval for safety and compliance",
      "minimumApprovers": 1,
      "approverGroups": ["platform-leads", "engineering-leads"]
    }
  },
  "actions": [
    {
      "action": "deployment.service.production",
      "label": "Deploy to Production",
      "description": "Deploy service to production environment (REQUIRES APPROVAL)",
      "primary": true
    },
    {
      "action": "deployment.service.staging",
      "label": "Deploy to Staging",
      "description": "Deploy service to staging environment (no approval required)",
      "primary": false
    },
    {
      "action": "deployment.service.development",
      "label": "Deploy to Development",
      "description": "Deploy service to development environment (no approval required)",
      "primary": false
    }
  ],
  "inputs": {
    "type": "object",
    "properties": {
      "serviceName": {
        "type": "string",
        "description": "Name of the service to deploy to production",
        "pattern": "^[a-z0-9-]+$",
        "minLength": 3,
        "maxLength": 64,
        "default": "my-service"
      },
      "imageTag": {
        "type": "string",
        "description": "Docker image tag to deploy",
        "pattern": "^v[0-9]+\\.[0-9]+\\.[0-9]+$",
        "default": "v1.0.0"
      },
      "replicas": {
        "type": "number",
        "description": "Number of pod replicas",
        "minimum": 1,
        "maximum": 10,
        "default": 3
      },
      "justification": {
        "type": "string",
        "description": "Justification for this production deployment (REQUIRED)",
        "minLength": 10,
        "ui:widget": "textarea",
        "ui:options": {
          "rows": 4,
          "placeholder": "Explain why this production deployment is needed (security review, bug fix, new feature, etc.)..."
        }
      }
    },
    "required": ["serviceName", "imageTag", "replicas", "justification"]
  },
  "outputs": {
    "deploymentStatus": {
      "description": "Deployment status",
      "type": "string"
    },
    "approvalRequired": {
      "description": "Whether approval was required",
      "type": "boolean"
    },
    "approvalRequestId": {
      "description": "Approval request ID if created",
      "type": "string"
    }
  },
  "steps": [
    {
      "id": "deploy_production",
      "name": "Deploy to Production (Requires Approval)",
      "action": "deployment.service.production",
      "inputs": {
        "service_name": "{{.Inputs.serviceName}}",
        "version": "{{.Inputs.imageTag}}",
        "replicas": {{.Inputs.replicas}}
      }
    }
  ],
  "rollback": {
    "enabled": true,
    "steps": [
      {
        "id": "rollback_deployment",
        "name": "Rollback Production Deployment",
        "action": "deployment.rollback",
        "inputs": {
          "deployment_id": "{{.Outputs.deployment_id}}",
          "target_version": "previous"
        }
      }
    ]
  }
}
