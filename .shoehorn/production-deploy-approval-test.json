{
  "$schema": "https://shoehorn.dev/schemas/workflow-v2.json",
  "version": "1.0.0",
  "metadata": {
    "name": "production-deploy-approval-test",
    "displayName": "Production Deployment (Approval Test)",
    "description": "Real deployment action that triggers approval workflow",
    "author": "platform-team",
    "icon": "ðŸš€",
    "category": "deployment",
    "tags": ["deployment", "production", "approval", "test"],
    "requiresApproval": true,
    "approvalMetadata": {
      "reason": "Production deployments require approval from platform leads",
      "minimumApprovers": 1,
      "approverGroups": ["platform-leads", "engineering-leads"]
    }
  },
  "actions": [
    {
      "action": "deployment.service.production",
      "label": "Deploy to Production",
      "description": "Deploy service to production (REQUIRES APPROVAL)",
      "primary": true
    },
    {
      "action": "deployment.service.staging",
      "label": "Deploy to Staging",
      "description": "Deploy service to staging (no approval)",
      "primary": false
    }
  ],
  "inputs": {
    "type": "object",
    "properties": {
      "service_name": {
        "type": "string",
        "description": "Name of the service to deploy",
        "pattern": "^[a-z0-9-]+$",
        "minLength": 3,
        "maxLength": 64,
        "default": "test-service"
      },
      "version": {
        "type": "string",
        "description": "Service version to deploy",
        "pattern": "^v[0-9]+\\.[0-9]+\\.[0-9]+$",
        "default": "v1.0.0"
      },
      "replicas": {
        "type": "number",
        "description": "Number of replicas to deploy",
        "minimum": 1,
        "maximum": 10,
        "default": 3
      },
      "justification": {
        "type": "string",
        "description": "Why is this deployment needed?",
        "minLength": 10,
        "ui:widget": "textarea",
        "ui:options": {
          "rows": 3,
          "placeholder": "Explain the reason for this production deployment..."
        }
      }
    },
    "required": ["service_name", "version", "replicas", "justification"]
  },
  "outputs": {
    "deployment_id": {
      "description": "Unique deployment identifier",
      "type": "string"
    },
    "status": {
      "description": "Deployment status",
      "type": "string"
    },
    "deployed_at": {
      "description": "Deployment timestamp",
      "type": "string"
    },
    "approval_required": {
      "description": "Whether approval was required",
      "type": "boolean"
    }
  },
  "steps": [
    {
      "id": "deploy_production",
      "name": "Deploy to Production Environment",
      "action": "deployment.service.production",
      "inputs": {
        "service_name": "{{.Inputs.service_name}}",
        "version": "{{.Inputs.version}}",
        "replicas": {{.Inputs.replicas}}
      }
    }
  ],
  "rollback": {
    "enabled": true,
    "steps": [
      {
        "id": "rollback_deployment",
        "name": "Rollback Production Deployment",
        "action": "deployment.rollback",
        "inputs": {
          "deployment_id": "{{.Outputs.deployment_id}}",
          "target_version": "previous"
        }
      }
    ]
  }
}
